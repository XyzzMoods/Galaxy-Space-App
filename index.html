<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Galaxy Space App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    .glass {
      @apply bg-white/5 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl;
    }

    @keyframes float { 0%{transform:translateY(0) scale(1);} 50%{transform:translateY(-8px) scale(1.08);} 100%{transform:translateY(0) scale(1);} }
    .float { animation:float 2.2s ease-in-out infinite; }

    @keyframes spin { to { transform:rotate(360deg); } }
    .spinner { border:4px solid transparent; border-top:4px solid #34d399; border-radius:50%; width:24px; height:24px; animation:spin .6s linear infinite; }

    @media (prefers-reduced-motion: reduce) {
      *, ::before, ::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
    }

    .btn-ripple {
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
    }
    .btn-ripple span.ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 600ms linear;
      background-color: rgba(255,255,255,.25);
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #34d399; border-radius: 3px; }
  </style>
</head>

<body class="bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 text-neutral-100 min-h-screen flex flex-col font-sans overflow-x-hidden">

  <main class="flex-grow flex items-center justify-center p-4">
    <div class="w-full max-w-md md:max-w-lg" id="mainWrapper">

      <!-- Title -->
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-2">
        <span class="float inline-block">üåê</span> <span id="title">Galaxy Space App</span>
      </h1>
      <p class="text-center text-neutral-400 mb-8">Deploy Website Kamu Dalam Beberapa Menit</p>

      <!-- Card -->
      <div class="glass p-6 md:p-8 space-y-6" id="card">

        <!-- Dropzone -->
        <div id="dropZone"
             class="relative border-2 border-dashed border-neutral-600 rounded-xl p-8 text-center cursor-pointer
                    transition-all duration-300 hover:border-emerald-400 hover:bg-emerald-500/5 active:scale-[.98]">
          <input type="file" id="fileInput" accept=".html,.zip" hidden />
          <div id="dropIcon" class="text-6xl mb-2 transition-transform duration-300">üìÅ</div>
          <span id="dropText" class="text-neutral-300">Drag & drop <strong>.html</strong> atau <strong>.zip</strong></span>
          <p id="fileName" class="text-emerald-400 mt-2 hidden truncate"></p>
        </div>

        <!-- Subdomain -->
        <div>
          <label class="block text-sm mb-1 font-medium">Nama Subdomain</label>
          <input id="subdomain" type="text" placeholder="my project"
                 class="w-full bg-white/5 border border-white/20 rounded-md px-4 py-2.5
                        focus:outline-none focus:ring-2 focus:ring-emerald-400 transition" />
          <p id="subError" class="text-rose-400 text-xs mt-1 hidden">Minimal 3 karakter, huruf kecil/angka/-</p>
        </div>

        <!-- Button -->
        <button id="deployBtn"
                class="btn-ripple relative w-full bg-emerald-500 hover:bg-emerald-400 active:bg-emerald-600
                       text-white font-semibold py-3 rounded-md transition-all duration-200 transform active:scale-95
                       flex items-center justify-center disabled:opacity-60 disabled:cursor-not-allowed">
          <span id="btnText">Deploy</span>
          <span id="btnLoader" class="spinner ml-2 hidden"></span>
        </button>
      </div>

      <!-- Result -->
      <div id="resultBox" class="glass mt-6 p-4 hidden">
        <p id="resultText" class="text-center break-words"></p>
        <button id="resetBtn"
                class="mt-3 w-full bg-white/10 hover:bg-white/20 rounded py-2 text-sm transition">
          Deploy Lagi
        </button>
      </div>
    </div>
  </main>

  <footer class="text-center py-5 text-sm text-neutral-500 border-t border-white/5">
    ¬© 2025 XyzzMoods - Blockchain Developer
  </footer>

  <!-- ========== GSAP + JS ========== -->
  <script>
    const $ = s => document.querySelector(s);
    const dropZone   = $('#dropZone');
    const fileInput  = $('#fileInput');
    const dropText   = $('#dropText');
    const fileNameP  = $('#fileName');
    const subdomain  = $('#subdomain');
    const subError   = $('#subError');
    const deployBtn  = $('#deployBtn');
    const btnText    = $('#btnText');
    const btnLoader  = $('#btnLoader');
    const resultBox  = $('#resultBox');
    const resultText = $('#resultText');
    const resetBtn   = $('#resetBtn');

    // ---------- GSAP intro ----------
    gsap.from("#mainWrapper > *", {duration: .8, y:40, opacity:0, stagger:.15, ease:"power2.out"});

    // ---------- Drag & Drop ----------
    ['dragenter','dragover'].forEach(e => dropZone.addEventListener(e, ()=>dropZone.classList.add('border-emerald-400','bg-emerald-500/10')));
    ['dragleave','drop'].forEach(e => dropZone.addEventListener(e, ()=>dropZone.classList.remove('border-emerald-400','bg-emerald-500/10')));
    ['dragenter','dragover','dragleave','drop'].forEach(e => dropZone.addEventListener(e, ev => ev.preventDefault()));
    dropZone.addEventListener('drop', e => { const f = e.dataTransfer.files[0]; if(f) handleFile(f); });
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));

    function handleFile(f){
      if(!/\.(html|zip)$/i.test(f.name)) return alert('File harus .html atau .zip');
      fileInput.files = createFileList(f);
      dropText.textContent = 'File siap';
      fileNameP.textContent = f.name;
      fileNameP.classList.remove('hidden');
      gsap.from(fileNameP, {scale: .8, opacity: 0, duration: .3});
    }
    function createFileList(f){
      const dt = new DataTransfer(); dt.items.add(f); return dt.files;
    }

    // ---------- Subdomain validation ----------
    subdomain.addEventListener('input', () => {
      const ok = /^[a-z0-9-]{3,64}$/.test(subdomain.value.trim());
      subError.classList.toggle('hidden', ok);
    });

    // ---------- Ripple effect ----------
    deployBtn.addEventListener('click', function(e){
      const ripple = document.createElement("span");
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      ripple.style.width = ripple.style.height = size + "px";
      ripple.style.left = e.clientX - rect.left - size/2 + "px";
      ripple.style.top  = e.clientY - rect.top  - size/2 + "px";
      ripple.classList.add("ripple");
      this.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    });

    // ---------- Deploy ----------
    deployBtn.addEventListener('click', async () => {
      const file = fileInput.files[0];
      const sub  = subdomain.value.trim().toLowerCase().replace(/[^a-z0-9-]/g,'');
      if(!sub || !/^[a-z0-9-]{3,64}$/.test(sub)) return subError.classList.remove('hidden');
      if(!file) return alert('Pilih file dulu');

      deployBtn.disabled = true;
      btnText.textContent = 'Deploying...';
      btnLoader.classList.remove('hidden');

      const fd = new FormData();
      fd.append('subdomain', sub);
      const filename = file.name.endsWith('.zip') ? 'project.zip' : 'index.html';
      fd.append('file', file, filename);

      try {
        const res = await fetch('https://apii.baguss.web.id/deploy', {method:'POST', body:fd});
        const j   = await res.json();
        if(!j.success) throw new Error(j.message || 'Unknown');
        resultText.innerHTML = `
          ‚úÖ <strong class="text-emerald-400">Deploy berhasil!</strong><br/>
          üåê <a href="${j.fullDomain}" target="_blank" class="underline decoration-emerald-400">${j.fullDomain}</a><br/>
          <span class="text-sm text-neutral-400">Website Akan Aktif Dalam 1‚Äì5 menit, kaga usah spam ngentod</span>`;
      } catch(e) {
        resultText.innerHTML = `‚ùå Gagal: ${e.message}`;
      } finally {
        gsap.fromTo(resultBox, {scale:.95, opacity:0}, {scale:1, opacity:1, duration:.35});
        resultBox.classList.remove('hidden');
        btnText.textContent = 'Deploy';
        btnLoader.classList.add('hidden');
        deployBtn.disabled = false;
      }
    });

    // ---------- Reset ----------
    resetBtn.addEventListener('click', () => {
      gsap.to(resultBox, {scale:.95, opacity:0, duration:.3, onComplete: ()=> resultBox.classList.add('hidden')});
      fileInput.value='';
      subdomain.value='';
      fileNameP.classList.add('hidden');
      dropText.textContent = 'Drag & drop .html atau .zip';
      gsap.from("#card", {scale:.96, duration:.35, ease:"power2.out"});
    });
  </script>
</body>
</html>
